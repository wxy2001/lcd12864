C51 COMPILER V9.57.0.0   OS_CPU_C                                                          06/08/2022 11:54:36 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE OS_CPU_C
OBJECT MODULE PLACED IN .\OutPut\OS_CPU_C.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE uCosii\OS_CPU_C.C LARGE OPTIMIZE(8,SIZE) BROWSE DEBUG OBJECTEXTEND PRINT
                    -(.\OutPut\OS_CPU_C.lst) TABS(2) OBJECT(.\OutPut\OS_CPU_C.obj)

line level    source

   1          /*
   2          *********************************************************************************************************
   3          *                                               uC/OS-II
   4          *                                                µ ±ƒ⁄∫À
   5          *
   6          *                        (c) Copyright 1992-1998, Jean J. Labrosse, Plantation, FL
   7          *                                               ∞Ê»®À˘”–
   8          *
   9          *                                            MCU-51 ◊®”√¥˙¬Î
  10          *                                           KEIL C51¥Ûƒ£ Ω±‡“Î
  11          *
  12          * Œƒº˛√˚ : OS_CPU_C.C
  13          * ◊˜’ﬂ   : Jean J. Labrosse
  14          *********************************************************************************************************
  15          */
  16          
  17          #define  OS_CPU_GLOBALS
  18          #include "source\includes.h"
  19          
  20          /*
  21          *********************************************************************************************************
  22          *                                        ≥ı ºªØ»ŒŒÒ∂—’ª
  23          *
  24          * √Ë ˆ       : ’‚∏ˆ∫Ø ˝±ªOSTaskCreate()ªÚOSTaskCreateExt()µ˜”√£¨“‘±„≥ı ºªØ–¬¥¥Ω®»ŒŒÒµƒ∂—’ªΩ·ππ°£±æ∫Ø ˝
  25          *              ”Î¥¶¿Ì∆˜∏ﬂ∂»œ‡πÿ°£
  26          *
  27          * ≤Œ ˝       : task          ÷∏œÚ»ŒŒÒ¥˙¬Îµƒ÷∏’Î
  28          *
  29          *              pdata         µ±»ŒŒÒµ⁄“ª¥Œ÷¥–– ±Ω´“™¥´»Î»ŒŒÒµƒ”√ªß ˝æ›Ω·ππ÷∏’Î
  30          *
  31          *              ptos          ’ª∂•÷∏’Î°£ptos÷∏’Î±ªƒ¨»œŒ™”√ªß∂—’ª»Îø⁄÷∏’Î°£»Áπ˚OS_STK_GROWTH±ª÷√1£¨ƒ«√¥£¨
  32          *                            ptos÷∏œÚ”√ªß∂—’ªµƒ◊Ó∏ﬂ”––ßµÿ÷∑°£Õ¨—˘µÿ£¨»Áπ˚OS_STK_GROWTH«Â0£¨ptosΩ´÷∏œÚ
  33          *                            ”√ªß∂—’ªµƒ◊ÓµÕ”––ßµÿ÷∑°£
  34          *
  35          *              opt           ÷∏∂®ø…“‘∏ƒ±‰OSTaskStkInit()––Œ™µƒ—°œÓ°£(º˚uCOS_II.H for OS_TASK_OPT_???)°£
  36          *
  37          * ∑µªÿ÷µ     : Œ“–ﬁ∏ƒ¡À‘≠¿¥µƒ≥Ã–Ú£¨ π∫Ø ˝◊‹ «∑µªÿ”√ªß∂—’ªø’º‰µƒ◊ÓµÕ”––ßµÿ÷∑°£’‚—˘–ﬁ∏ƒÃ·∏ﬂ¡ÀTCBªª»Îªª≥ˆ
  38          *              µƒ–ß¬ °£
  39          *
  40          * ◊¢“‚       : »ŒŒÒ∂—’ªΩ·ππ:
  41          *
  42          *                                    ---------- -
  43          *                 ”√ªß’ª◊Ó∏ﬂµÿ÷∑---->|        | |
  44          *                                    ---------- |
  45          *                                    |   ...  | ∑¬’Ê∂—’ªø’º‰
  46          *----------                          ---------- | √ø»ŒŒÒ“ª∏ˆ
  47          *|OSTCBCur|               ?C_XBP---->|        | | KEIL◊‘∂Ø¥¶¿Ì
  48          *----------                          ---------- -
  49          *    |                               |ø’œ–º‰∏Ù|
  50          *    |     -----------------------   ----------                           ----------
  51          *    \---->|OSTCBCur->OSTCBStkPtr|   |?C_XBPµÕ|                    SP---->|        |
  52          *          -----------------------   ----------                           ----------
  53          *                     |              |?C_XBP∏ﬂ|                           |        |
  54          *                     |              ---------- -                         ----------
C51 COMPILER V9.57.0.0   OS_CPU_C                                                          06/08/2022 11:54:36 PAGE 2   

  55          *                     |              |        | |                         |   .    |
  56          *                     |              ---------- |                         |   .    |
  57          *                     |              |        | |                         |   .    |
  58          *                     |              ---------- |                         ----------
  59          *                     |              |   .    |≥§∂»                       |        | +1
  60          *                     |              |   .    | |                         ----------
  61          *                     |              |   .    | |             OSStack---->|        | 0
  62          *                     |              ---------- |                         ----------
  63          *                     |              |        | |          OSStkStart---->| ≤ªπÿ–ƒ | -1  µÕµÿ÷∑
  64          *                     |              ---------- -                         ----------
  65          *                     \------------->|  ≥§∂»  | µÕµÿ÷∑                   œµÕ≥”≤º˛∂—’ª
  66          *                                    ----------
  67          *                                     ”√ªß∂—’ª                       ≥§∂»=SP-OSStkStart
  68          *********************************************************************************************************
  69          */
  70          
  71          OS_STK *OSTaskStkInit (void (*task)(void *pd) reentrant, void *ppdata, OS_STK *ptos, INT16U opt) reentrant
  72          {    
  73   1          OS_STK *stk;
  74   1      
  75   1          ppdata = ppdata;
  76   1          opt    = opt;                               //opt√ª±ª”√µΩ£¨±£¡Ù¥À”Ôæ‰∑¿÷π∏ÊæØ≤˙…˙    
  77   1          stk    = ptos;                              //”√ªß∂—’ª◊ÓµÕ”––ßµÿ÷∑
  78   1          *stk++ = 15;                                //”√ªß∂—’ª≥§∂»  15 
  79   1          *stk++ = (INT16U)task & 0xFF;               //»ŒŒÒµÿ÷∑µÕ8Œª (1)
  80   1          *stk++ = (INT16U)task >> 8;                 //»ŒŒÒµÿ÷∑∏ﬂ8Œª (2)   
  81   1          *stk++ = 0x0A;                              //ACC     (3)
  82   1          *stk++ = 0x0B;                              //B       (4)
  83   1          *stk++ = 0x00;                              //DPH     (5)
  84   1          *stk++ = 0x00;                              //DPL     (6)
  85   1          *stk++ = 0x00;                              //PSW     (7)
  86   1          *stk++ = 0x00;                              //R0      (8)
  87   1          
  88   1        //R3°¢R2°¢R1”√”⁄¥´µ›»ŒŒÒ≤Œ ˝ppdata£¨∆‰÷–R3¥˙±Ì¥Ê¥¢∆˜¿‡–Õ£¨R2Œ™∏ﬂ◊÷Ω⁄∆´“∆£¨R1Œ™µÕ◊÷Ω⁄Œª“∆°£
  89   1        //Õ®π˝∑÷ŒˆKEILª„±‡£¨¡ÀΩ‚µΩ»ŒŒÒµƒvoid *ppdata≤Œ ˝«°∫√ «”√R3°¢R2°¢R1¥´µ›£¨≤ª «Õ®π˝–Èƒ‚∂—’ª°£
  90   1          *stk++ = (INT16U)ppdata & 0xFF;             //R1      (9)
  91   1          *stk++ = (INT16U)ppdata >> 8;               //R2      (10)
  92   1          *stk++ = 0x01;                              //R3  (11) XDATA£¨À˘“‘¥Ê¥¢∆˜¿‡–ÕπÃ∂®Œ™1£¨º˚C51.PDFµ⁄178“≥À
             -µ√˜°£
  93   1      
  94   1          *stk++ = 0x04;                              //R4      (12)
  95   1          *stk++ = 0x05;                              //R5      (13)
  96   1          *stk++ = 0x06;                              //R6      (14)
  97   1          *stk++ = 0x07;                              //R7      (15)
  98   1                                                      //≤ª”√±£¥ÊSP£¨»ŒŒÒ«–ªª ±∏˘æ›”√ªß∂—’ª≥§∂»º∆À„µ√≥ˆ°£    
  99   1          *stk++ = (INT16U) (ptos+MaxStkSize) >> 8;   //?C_XBP ∑¬’Ê∂—’ª÷∏’Î∏ﬂ8Œª
 100   1          *stk++ = (INT16U) (ptos+MaxStkSize) & 0xFF; //?C_XBP ∑¬’Ê∂—’ª÷∏’ÎµÕ8Œª
 101   1              
 102   1          return ((void *)ptos);
 103   1      }
 104          
 105          #if OS_CPU_HOOKS_EN
 106          
 107          /*
 108          *********************************************************************************************************
 109          *                                       OS INITIALIZATION HOOK
 110          *                                            (BEGINNING)
 111          *
 112          * Description: This function is called by OSInit() at the beginning of OSInit().
 113          *
 114          * Arguments  : none
 115          *
C51 COMPILER V9.57.0.0   OS_CPU_C                                                          06/08/2022 11:54:36 PAGE 3   

 116          * Note(s)    : 1) Interrupts should be disabled during this call.
 117          *********************************************************************************************************
 118          */
 119          #if OS_VERSION > 203
 120          void OSInitHookBegin (void) reentrant
 121          {
 122   1      
 123   1      }
 124          #endif
 125          
 126          /*
 127          *********************************************************************************************************
 128          *                                       OS INITIALIZATION HOOK
 129          *                                               (END)
 130          *
 131          * Description: This function is called by OSInit() at the end of OSInit().
 132          *
 133          * Arguments  : none
 134          *
 135          * Note(s)    : 1) Interrupts should be disabled during this call.
 136          *********************************************************************************************************
 137          */
 138          #if OS_VERSION > 203
 139          void OSInitHookEnd (void) reentrant
 140          {
 141   1      }
 142          #endif
 143          
 144          /*
 145          *********************************************************************************************************
 146          *                                          »ŒŒÒ¥¥Ω®π≥π“∫Ø ˝
 147          *
 148          * √Ë ˆ       : »ŒŒÒ¥¥Ω® ±µ˜”√
 149          *
 150          * ≤Œ ˝       : ptcb «÷∏œÚΩ´±ª¥¥Ω®»ŒŒÒµƒ»ŒŒÒøÿ÷∆øÈµƒ÷∏’Î°£
 151          *
 152          * ◊¢“‚       : 1) µ˜”√∆⁄º‰÷–∂œ±ªΩ˚÷π
 153          *********************************************************************************************************
 154          */
 155          void OSTaskCreateHook (OS_TCB *ptcb) reentrant
 156          {
 157   1          ptcb = ptcb;                       /* Prevent compiler warning                                     */
 158   1      }
 159          
 160          
 161          /*
 162          *********************************************************************************************************
 163          *                                          »ŒŒÒ…æ≥˝π≥π“∫Ø ˝
 164          *
 165          * √Ë ˆ       : »ŒŒÒ…æ≥˝ ±µ˜”√
 166          *
 167          * ≤Œ ˝       : ptcb «÷∏œÚΩ´±ª…æ≥˝»ŒŒÒµƒ»ŒŒÒøÿ÷∆øÈµƒ÷∏’Î°£
 168          *
 169          * ◊¢“‚       : 1) µ˜”√∆⁄º‰÷–∂œ±ªΩ˚÷π
 170          *********************************************************************************************************
 171          */
 172          #if OS_TASK_DEL_EN > 0
              void OSTaskDelHook (OS_TCB *ptcb) reentrant
              {
                  ptcb = ptcb;                       /* Prevent compiler warning                                     */
                
              }
C51 COMPILER V9.57.0.0   OS_CPU_C                                                          06/08/2022 11:54:36 PAGE 4   

              #endif
 179          
 180          /*
 181          *********************************************************************************************************
 182          *                                          »ŒŒÒ«–ªªπ≥π“∫Ø ˝
 183          *
 184          * √Ë ˆ       : ÷¥––»ŒŒÒ«–ªª ±µ˜”√°£’‚‘ –Ìƒ„‘⁄…œœ¬Œƒ«–ªª∆⁄º‰÷¥––∆‰À¸≤Ÿ◊˜°£
 185          *
 186          * ≤Œ ˝       : Œﬁ
 187          *
 188          * ◊¢“‚       : 1) µ˜”√∆⁄º‰÷–∂œ±ªΩ˚÷π
 189          *              2) ºŸ∂®»´æ÷÷∏’Î'OSTCBHighRdy'“—æ≠÷∏œÚ¡ÀΩ´“™±ªªª»Îµƒ»ŒŒÒøÿ÷∆øÈ(º¥:◊Ó∏ﬂ”≈œ»º∂»ŒŒÒ)£¨≤¢«“
 190          *                 'OSTCBCur'÷∏œÚ¡ÀΩ´±ªªª≥ˆµƒ»ŒŒÒ(º¥:µ±«∞»ŒŒÒ)°£
 191          *********************************************************************************************************
 192          */
 193          void OSTaskSwHook (void) reentrant
 194          {
 195   1      }
 196          
 197          /*
 198          *********************************************************************************************************
 199          *                                          Õ≥º∆»ŒŒÒπ≥π“∫Ø ˝
 200          *
 201          * √Ë ˆ       : ’‚∏ˆ∫Ø ˝√ø√Î÷”±ªuC/OS-IIÕ≥º∆»ŒŒÒµ˜”√°£’‚√¥◊ˆ πƒ„µƒ”¶”√≥Ã–Úø…“‘‘ˆº”Õ≥º∆»ŒŒÒµƒπ¶ƒ‹°£
 202          *
 203          * ◊¢“‚       : Œﬁ
 204          *********************************************************************************************************
 205          */
 206          #if OS_TASK_STAT_EN > 0
              void OSTaskStatHook (void) reentrant
              {
              }
              #endif
 211          
 212          /*
 213          *********************************************************************************************************
 214          *                                           OSTCBInit() HOOK
 215          *
 216          * Description: This function is called by OSTCBInit() after setting up most of the TCB.
 217          *
 218          * Arguments  : ptcb    is a pointer to the TCB of the task being created.
 219          *
 220          * Note(s)    : 1) Interrupts may or may not be ENABLED during this call.
 221          *********************************************************************************************************
 222          */
 223          #if OS_VERSION > 203
 224          void OSTCBInitHook (OS_TCB *ptcb) reentrant
 225          {
 226   1          ptcb = ptcb;                                           /* Prevent Compiler warning                 */
 227   1      }
 228          #endif
 229          
 230          /*
 231          *********************************************************************************************************
 232          *                                          ∂® ±π≥π“∫Ø ˝
 233          *
 234          * √Ë ˆ       : ±æ∫Ø ˝√ø“ªµŒ¥±ªµ˜”√“ª¥Œ°£
 235          *
 236          * ≤Œ ˝       : Œﬁ
 237          *
 238          * ◊¢“‚       : 1) ‘⁄±æµ˜”√∆⁄º‰÷–∂œø…“‘ªÚ≤ªø…“‘ πƒ‹°£
 239          *********************************************************************************************************
C51 COMPILER V9.57.0.0   OS_CPU_C                                                          06/08/2022 11:54:36 PAGE 5   

 240          */
 241          void OSTimeTickHook (void) reentrant
 242          {
 243   1      }
 244          
 245          /*
 246          *********************************************************************************************************
 247          *                                             IDLE TASK HOOK
 248          *
 249          * Description: This function is called by the idle task.  This hook has been added to allow you to do  
 250          *              such things as STOP the CPU to conserve power.
 251          *
 252          * Arguments  : none
 253          *
 254          * Note(s)    : 1) Interrupts are enabled during this call.
 255          *********************************************************************************************************
 256          */
 257          #if OS_VERSION >= 251
 258          void OSTaskIdleHook (void) reentrant
 259          {
 260   1      }
 261          #endif
 262          
 263          #endif
 264          
 265          /*
 266              π”√C”Ô—‘µƒ÷–∂œ¥¶¿Ì∫Ø ˝”–÷˙”ÎÃ·∏ﬂ≥Ã–Úµƒ“∆÷≤–‘°£Ω®“È÷–∂œ≥Ã–Ú≤ª“™Ã´≥§£¨»Áπ˚≥§‘Ú π”√–≈∫≈¡ø¿¥”Î»ŒŒÒÕ¨≤Ω£¨
 267             ‘⁄Õ‚≤ø»ŒŒÒ÷– µœ÷¥Û¡øµƒ¥¶¿Ì°£
 268             ÷–∂œ¥¶¿Ì¿˝≥Ã∂º∑≈‘⁄œ¬√Ê°£
 269          */
 270          
 271          /*
 272          void UserTickTimer(void)
 273          {
 274              TH0=0xB8;       //∆’Õ®51∂® ±∆˜∑Ω Ω1£¨±ÿ–Î‘⁄∑¢…˙÷–∂œ ±£¨÷ÿ–¬∏≥÷µ≤¢‘Ÿ¥Œ∆Ù∂Øº∆ ±
 275              TL0=0;              //Tick=50¥Œ/√Î(º¥0.02√Î/¥Œ)£¨æß’Ò11.0592M
 276              TR0=1;
 277          }
 278           
 279          //uCOS-IIœµÕ≥ ±÷”÷–∂œ¥¶¿Ì≥Ã–Ú
 280          void OSTickISR(void) interrupt 1
 281          {
 282              OSIntEnter();         // Must be called first at every hardware interrupt entry point 
 283              UserTickTimer();        // User functions can be called here.
 284              OSTimeTick();         // Must be called during tick isr 
 285              OSIntExit();          // Must be called finally at every hardware interupt exit point 
 286          }
 287          */
 288          /*
 289            …Ë÷√”≤º˛ºƒ¥Ê∆˜µƒ≥ı º÷µ°£
 290            ≥ı ºªØ∂® ±∆˜0,◊˜Œ™ucOS-IIµƒœµÕ≥ ±÷”°£
 291            ªπ”–∆‰À˚µƒ”Î”≤º˛œ‡πÿµƒ≥ı ºªØ“≤ø…“‘∑≈‘⁄’‚¿Ô°£
 292          */
*** WARNING C290 IN LINE 103 OF uCosii\OS_CPU_C.C: missing return value


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    547    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
C51 COMPILER V9.57.0.0   OS_CPU_C                                                          06/08/2022 11:54:36 PAGE 6   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
